<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Spin Final Fix</title>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:transparent;
    text-align:center;
}
.container{
    width:260px;
    margin:15px auto;
    padding:10px;
}
.header{color:white;font-size:12px}

/* VIEWPORT */
.viewport{
    width:240px;
    height:80px;
    overflow:hidden;
    border:2px solid white;
    border-radius:8px;
    margin:10px auto;
    position:relative;
}

/* JARUM */
.clock{
    position:absolute;
    top:-6px;
    left:50%;
    transform:translateX(-50%);
    z-index:30;
}
.clock::before{
    content:"";
    width:2px;height:30px;
    background:gold;
    position:absolute;
    left:-1px;
}
.clock::after{
    content:"";
    width:12px;height:12px;
    background:gold;
    border-radius:50%;
    position:absolute;
    top:-5px;left:-6px;
}

.track{display:flex;height:60px}
.item{
    width:60px;height:60px;
    flex-shrink:0;
    display:flex;
    align-items:center;
    justify-content:center;
}
.item img{width:48px;height:48px}

.zonk{background:#444}
.sc{background:limegreen}
.mitos{background:red}
.lochnes{background:#0b3c5d}
.maja{background:#5d2b0b}

.stop{
    box-shadow:inset 0 0 0 3px white,0 0 14px gold;
    animation:pulse 1s infinite;
}
@keyframes pulse{
    0%{box-shadow:inset 0 0 0 3px white,0 0 8px gold}
    50%{box-shadow:inset 0 0 0 3px white,0 0 18px gold}
    100%{box-shadow:inset 0 0 0 3px white,0 0 8px gold}
}

.spin-btn{
    width:55px;height:55px;
    border-radius:50%;
    border:2px solid white;
    background:rgba(255,255,255,.15);
}

.result{margin-top:8px;min-height:40px}
.result img{width:32px;height:32px}
</style>
</head>

<body>

<div class="container">
    <div class="header">ðŸ’° 5 Coin untuk 1 Putaran</div>

    <div class="viewport">
        <div class="clock"></div>
        <div class="track" id="track"></div>
    </div>

    <button class="spin-btn" onclick="spin()"></button>
    <div class="result" id="result"></div>
</div>

<!-- AUDIO -->
<audio id="spinSound" src="spin1.mp3"></audio>
<audio id="zonkAudio" src="zonk1.mp3"></audio>
<audio id="sctbAudio" src="sctb1.mp3"></audio>
<audio id="mitosAudio" src="mitos1.mp3"></audio>
<audio id="lochnesAudio" src="lochnes.mp3"></audio>
<audio id="majaAudio" src="maja.mp3"></audio>

<script>
/* VISUAL (Lochnes hanya visual) */
const visual=[
 {id:"L",cls:"lochnes",img:"lochnes.png",audio:"lochnesAudio"},
 {id:"MJ",cls:"maja",img:"maja.png",audio:"majaAudio"},
 {id:"SC",cls:"sc",img:"sc_tb.png",audio:"sctbAudio"},
 {id:"MT",cls:"mitos",img:"mitos.png",audio:"mitosAudio"},
 {id:"A",cls:"zonk",img:"zonk.png",audio:"zonkAudio"}
];

/* PELUANG MENANG */
const winPool=[
 {id:"MJ",w:7},     // 0,7%
 {id:"SC",w:50},    // 5%
 {id:"MT",w:150},   // 15%
 {id:"A",w:793}     // 79,3%
];

const track=document.getElementById("track");
const spinSound=document.getElementById("spinSound");

let data=[];
let currentIndex=0;

/* === TRACK: SETIAP HADIAH + 3 ZONK === */
const zonk = visual.find(v=>v.id==="A");

for(let i=0;i<120;i++){
 const h = visual[i % visual.length];

 if(h.id !== "A"){
   data.push(h, zonk, zonk, zonk);
 }else{
   data.push(h);
 }
}

/* RENDER */
data.forEach(h=>{
 const d=document.createElement("div");
 d.className=`item ${h.cls}`;
 d.dataset.id=h.id;
 d.dataset.audio=h.audio;
 d.innerHTML=`<img src="${h.img}">`;
 track.appendChild(d);
});

function pick(){
 let pool=[];
 winPool.forEach(h=>{
  for(let i=0;i<h.w;i++) pool.push(h.id);
 });
 return pool[Math.floor(Math.random()*pool.length)];
}

function playPrizeAudio(id){
 const a=document.getElementById(id);
 if(!a) return;
 a.currentTime=0;
 a.play().catch(()=>{});
}

function spin(){
 spinSound.currentTime=0;
 spinSound.loop=true;
 spinSound.play().catch(()=>{});

 const items=document.querySelectorAll(".item");
 items.forEach(i=>i.classList.remove("stop"));
 document.getElementById("result").innerHTML="";

 const winner=pick();

 const targets=data
  .map((h,i)=>h.id===winner?i:null)
  .filter(i=>i!==null && i>currentIndex+15);

 if(!targets.length){
  currentIndex=0;
  spin();
  return;
 }

 const index=targets[Math.floor(Math.random()*targets.length)];
 currentIndex=index;

 const ITEM=60;
 const center=120-(ITEM/2);

 track.style.transition="transform 7s cubic-bezier(.08,.85,.15,1)";
 track.style.transform=`translateX(${-(index*ITEM)+center}px)`;

 setTimeout(()=>{
  spinSound.pause();
  spinSound.currentTime=0;

  let closest=0,dist=Infinity;
  const needleX=document.querySelector(".clock").getBoundingClientRect().left;

  items.forEach((it,i)=>{
   const c=it.getBoundingClientRect().left+30;
   const d=Math.abs(c-needleX);
   if(d<dist){dist=d;closest=i;}
  });

  items[closest].classList.add("stop");
  document.getElementById("result")
    .appendChild(items[closest].querySelector("img").cloneNode());

  playPrizeAudio(items[closest].dataset.audio);
 },7000);
}
</script>

</body>
</html>
